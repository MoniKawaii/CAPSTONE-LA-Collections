================================================================================
CAPSTONE LA COLLECTIONS - PROGRESS TRACKER
================================================================================
Last Updated: November 4, 2025
Branch: liam5-yza5

================================================================================
COMPLETED TASKS
================================================================================

✅ TASK #1: Implement Scent/Volume Columns for Product Variants
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Replaced generic variant_attribute_1/2/3 columns with domain-specific 
     'scent' and 'volume' columns
   - Implemented smart parser with regex pattern to detect ml/mL/L units
   - Logic: If variant name contains ml pattern → volume field, else → scent
   - Created base variants for ALL 71 products (even those without variant data)
   
   Results:
   - Shopee variants increased from 15 to 58 (43 base variants added)
   - Total variants: 162 (104 Lazada + 58 Shopee)
   - All products now have at least 1 variant for proper joins
   
   Files Modified:
   - app/config.py (DIM_PRODUCT_VARIANT_COLUMNS schema)
   - app/Transformation/harmonize_dim_product.py (parse_variant_attributes function)

--------------------------------------------------------------------------------

✅ TASK #2: Transfer Prices from Products to Variants + Add Versioning
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Removed 'current_selling_price' from dim_product table
   - Added 4 new fields to dim_product_variant:
     * current_price (variant-level pricing)
     * original_price (before discounts)
     * created_at (timestamp)
     * last_updated (timestamp)
   - Updated extraction functions to populate prices at variant level
   - Implemented special pricing calculation for Lazada (time-based discounts)
   
   Results:
   - Price granularity: Product-level → Variant-level
   - Initial coverage: 119/162 variants with prices (73.5%)
   - All 162 variants have timestamps
   - Price range: ₱5 - ₱1,280
   
   Files Modified:
   - app/config.py (removed price from products, added to variants)
   - app/Transformation/harmonize_dim_product.py (extraction functions)

--------------------------------------------------------------------------------

✅ TASK #3: Impute Missing Prices for Base Variants
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Identified 43 base variants without prices (26.5% of total)
   - Implemented Option 1: Use product-level price_info for base variants
   - Modified extract_shopee_product_variants() to accept product_price_info
   - Function now uses product-level price when variant-level unavailable
   
   Results:
   - Price coverage improved from 73.5% to 95.1%
   - 35 base variants gained prices (81.4% of base variants)
   - 8 remaining products need Shopee variant API data (TODO #9)
   - Average price: ₱497.97
   
   Files Modified:
   - app/Transformation/harmonize_dim_product.py (extract_shopee_product_variants)

--------------------------------------------------------------------------------

✅ TASK #9: Resolve Shopee Variants API Issue
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Fixed shopee_api_calls.py to use individual item_id calls (not batch)
   - Created fetch_missing_variants.py script for targeted variant fetching
   - Fixed harmonization to handle new API response structure (model vs model_list)
   - Fixed price_info extraction (list instead of dict)
   - Fetched variant data for 13 products with has_model=True
   
   Results:
   - API successfully fetched 151 variant models
   - Shopee variants increased from 48 to 186 (151 real + 35 base)
   - Total variants increased from 162 to 290
   - Price coverage: 100% (all 290 variants have prices)
   - Average price: ₱527.64
   
   Files Modified:
   - app/Extraction/shopee_api_calls.py (extract_product_variants function)
   - app/Transformation/harmonize_dim_product.py (variant extraction logic)
   
   Files Created:
   - fetch_missing_variants.py (utility script)

--------------------------------------------------------------------------------

✅ TASK #4: Replace Missing SKUs with "not_found"
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Implemented fallback logic for canonical_sku extraction
   - Lazada: SellerSku → SkuId → "not_found"
   - Shopee: model_sku → model_id → "not_found"
   - Base variants: item_sku → item_id → "not_found"
   - Added validation to strip whitespace and handle empty strings
   
   Results:
   - SKU coverage improved from 67.6% to 100%
   - All 290 variants now have valid canonical_sku values
   - Previously 94 variants had NaN, now all populated
   - 0 variants marked as "not_found" (all had valid IDs)
   
   Files Modified:
   - app/Transformation/harmonize_dim_product.py (all variant extraction functions)

================================================================================
PENDING TASKS (In Priority Order)
================================================================================

================================================================================
PENDING TASKS (In Priority Order)
================================================================================

⏳ TASK #5: Derive Fact Table Schemas from Config Mappings
   Priority: High
   Estimated Effort: Medium
   Description: Auto-generate fact table schemas from config.py

⏳ TASK #6: Refactor Fact Tables for Data Consistency
   Priority: High
   Estimated Effort: High
   Description: Ensure fact tables align with dimension tables

⏳ TASK #7: Impute Other Missing Data
   Priority: Medium
   Estimated Effort: Medium
   Description: Handle NULL values in product ratings, categories, etc.

⏳ TASK #8: Update Lazada Product Reviews
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Added Lazada product review data loading to harmonize_dim_product.py
   - Implemented calculate_lazada_average_ratings() function to match reviews by item_id
   - Updated harmonize_lazada_product_record() to accept and use calculated ratings
   - Added rating imputation logic using overall platform average (4.92) for products without reviews
   - Updated config.py LAZADA_TO_UNIFIED_MAPPING to include review field mappings
   - Resolved data type mismatch between product item_id (int) and review item_id (string)
   - Integrated rating calculation into main harmonization workflow
   
   Results:
   - All 23 Lazada products now have ratings (100% coverage)
   - 14 products got review-based ratings (from 59 total reviews across 14 products)
   - 9 products got imputed ratings using overall average of 4.92
   - Rating distribution: 13 products @ 5.0, 1 product @ 4.77, 9 products @ 4.92
   - Average Lazada rating: 4.96
   - Harmonized ratings properly saved to dim_product.csv
   
   Files Modified:
   - app/Transformation/harmonize_dim_product.py (added rating functions and logic)
   - app/config.py (updated LAZADA_TO_UNIFIED_MAPPING with review fields)

--------------------------------------------------------------------------------

✅ TASK #10: Fix Order Dimension Harmonization
   Status: COMPLETED
   Date: November 4, 2025
   
   What was done:
   - Fixed harmonize_dim_order.py to properly follow config.py field mappings
   - Updated harmonization functions to use LAZADA_TO_UNIFIED_MAPPING and SHOPEE_TO_UNIFIED_MAPPING
   - Implemented payment method standardization using PAYMENT_METHOD_MAPPING from config
   - Added asterisk replacement logic for shipping_city (replaced with "N/A")
   - Removed platform_customer_id column as per DIM_ORDER_COLUMNS schema
   - Fixed column ordering to match exact DIM_ORDER_COLUMNS sequence
   - Added proper field initialization and default value handling
   
   Results:
   - Successfully harmonized 33,928 total orders (9,038 Lazada + 24,890 Shopee)
   - Correct column order: orders_key, platform_order_id, order_status, order_date, updated_at, price_total, total_item_count, payment_method, shipping_city, platform_key
   - Orders_key properly generated with platform decimals (.1 for Lazada, .2 for Shopee)
   - All shipping_city asterisked values replaced with "N/A"
   - Payment methods standardized using config mappings (13 unique methods)
   - 100% data coverage: all orders have valid dates and prices
   - Date range: 2020-09-19 to 2025-10-31
   - Schema compliance: Exact match to DIM_ORDER_COLUMNS structure
   
   Files Modified:
   - app/Transformation/harmonize_dim_order.py (complete refactor for config compliance)
   
   Field Mappings Applied:
   - Lazada: order_id → platform_order_id, statuses[0] → order_status, shipping_address.city → shipping_city
   - Shopee: order_sn → platform_order_id, order_status → order_status, recipient_address.city → shipping_city

--------------------------------------------------------------------------------

⏳ TASK #11: Update Descriptive Computations and Dashboard
   Priority: Low
   Estimated Effort: Medium
   Description: Recalculate metrics based on new schema

================================================================================
CURRENT DATA QUALITY METRICS
================================================================================

Dimension: dim_product
- Total Records: 71 (23 Lazada + 48 Shopee)
- Columns: 7 (removed current_selling_price)
- Coverage: 100%
- Product ratings coverage: 100% (68 from reviews + 3 imputed)

Dimension: dim_product_variant
- Total Records: 290 (104 Lazada + 186 Shopee)
- Columns: 11 (added scent, volume, prices, timestamps)
- Price Coverage: 100% (290/290 variants)
- Scent/Volume Coverage: 100%
- Timestamp Coverage: 100%

Dimension: dim_order
- Total Records: 33,928 (9,038 Lazada + 24,890 Shopee)
- Columns: 10 (orders_key, platform_order_id, order_status, order_date, updated_at, price_total, total_item_count, payment_method, shipping_city, platform_key)
- Coverage: 100% data quality - all orders have valid dates and prices
- Date Range: 2020-09-19 to 2025-10-31 (5+ years of order history)
- Order Status Distribution: 6 unique statuses (COMPLETED, CANCELLED, SHIPPED, etc.)
- Payment Methods: 13 standardized methods (COD, PLATFORM WALLET BALANCE, MIXEDCARD, etc.)
- Geographic Coverage: shipping_city data with asterisked values replaced by "N/A"
- Key Generation: Platform-specific decimals (.1 for Lazada, .2 for Shopee)

Shopee Variant Breakdown:
- Real variants: 151 (fetched from API)
- Base variants: 35 (products without variant data)
- Total: 186

Quality Improvements from Task #8 (Lazada Product Ratings):
- Lazada products with ratings: 23/23 (100% coverage)
- Rating sources: 14 from reviews, 9 imputed from overall average (4.92)
- Lazada average rating: 4.96 (range: 4.77 - 5.00)
- Review data integration: Successfully matched 59 reviews across 14 products
- Data consistency: Resolved item_id type mismatch between products and reviews

Quality Improvements from Task #11 (Order Dimension):
- Order harmonization: 33,928 orders successfully processed
- Schema compliance: 100% adherence to DIM_ORDER_COLUMNS structure
- Field mapping accuracy: All config.py mappings properly applied
- Data standardization: Payment methods and order statuses normalized
- Geographic data cleaning: Asterisked shipping cities replaced with "N/A"
- Temporal coverage: 5+ years of comprehensive order history

Identified Issues:
- ✅ RESOLVED: All products now have complete variant data
- ✅ RESOLVED: All Lazada products now have ratings (review-based or imputed)
- ✅ RESOLVED: Order dimension schema and field mapping issues

================================================================================
TECHNICAL NOTES
================================================================================

Schema Changes:
- DIM_PRODUCT: 8 columns → 7 columns (removed price)
- DIM_PRODUCT_VARIANT: 7 columns → 11 columns (added scent, volume, prices, timestamps)
- DIM_ORDER: 10 columns (orders_key through platform_key in correct sequence)

Key Functions Modified:
- parse_variant_attributes(): Returns (scent, volume) with ml detection
- extract_lazada_product_variants(): Adds prices + timestamps + base variants
- extract_shopee_product_variants(): Adds prices + timestamps + base variants
- harmonize_order_record(): Uses LAZADA_TO_UNIFIED_MAPPING for field extraction
- harmonize_shopee_order_record(): Uses SHOPEE_TO_UNIFIED_MAPPING for field extraction

Patterns Used:
- Volume Detection: r'\d+\s*(ml|ML|mL|Ml|l|L)\b'
- Platform Keys: 1=Lazada, 2=Shopee
- ID Strategy: Float decimals (x.1 for Lazada, x.2 for Shopee)
- Payment Standardization: PAYMENT_METHOD_MAPPING for consistency
- Asterisk Replacement: shipping_city with '*' → "N/A"

Understanding SKU Fields:
================================================================================

PLATFORM_SKU_ID (Platform's Internal ID)
- Purpose: Platform's system-generated unique identifier for each variant
- Source: 
  * Lazada: SkuId (e.g., 30683243468)
  * Shopee: model_id (e.g., 257229121669)
- Characteristics:
  * Always exists (never null)
  * Always unique per variant
  * Not human-readable
  * No business meaning
  * Used for platform-specific operations and API calls

CANONICAL_SKU (Unified Business Join Key)
- Purpose: Standardized SKU for data warehouse joins and business operations
- Source with Fallback Logic:
  * Lazada: SellerSku (your custom SKU) → SkuId (if no custom SKU)
  * Shopee: model_sku (your custom SKU) → model_id (if no custom SKU)
  * Base variants: item_sku → item_id → "not_found" (never reached)
- Characteristics:
  * Always populated (100% coverage)
  * Preferred: Your business SKU when available (human-readable like "LAV", "w180")
  * Fallback: Platform ID when no custom SKU exists
  * Used as primary join key across all fact tables
  * Standardized field name regardless of platform

Current Distribution:
- 142 variants (49.0%): Have custom business SKUs (canonical_sku ≠ platform_sku_id)
- 148 variants (51.0%): Use platform ID as canonical_sku (canonical_sku = platform_sku_id)
- 0 variants: Needed "not_found" fallback

Why Both Fields Matter:
- platform_sku_id: Traceability to platform's system, debugging, reconciliation
- canonical_sku: Business operations, data warehouse joins, analytics
- Together they provide both platform-specific tracking AND unified business logic

================================================================================
END OF PROGRESS TRACKER
================================================================================
